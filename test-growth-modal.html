<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„±ì¥ ì§„ë‹¨ íŒì—… í…ŒìŠ¤íŠ¸</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/mobile.css">
    <link rel="stylesheet" href="css/growth-modal.css">
    
    <style>
        body {
            padding: 40px 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            color: #1f2937;
            margin-bottom: 12px;
            font-size: 32px;
        }
        
        .subtitle {
            color: #64748b;
            margin-bottom: 32px;
            font-size: 16px;
        }
        
        .test-section {
            margin-bottom: 32px;
        }
        
        .test-section h2 {
            color: #374151;
            font-size: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .test-btn {
            width: 100%;
            padding: 16px 24px;
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, #14b8a6 0%, #0891b2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.3);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(20, 184, 166, 0.4);
        }
        
        .test-btn:active {
            transform: translateY(0);
        }
        
        .info-box {
            background: #f0fdfa;
            border-left: 4px solid #14b8a6;
            padding: 16px;
            border-radius: 8px;
            margin-top: 16px;
        }
        
        .info-box p {
            margin: 0;
            color: #0f766e;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .info-box strong {
            color: #0d9488;
        }
        
        .child-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #14b8a6;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 16px;
            cursor: pointer;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-top: 24px;
        }
        
        .stat-card {
            background: #f8fafc;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #0891b2;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin-top: 16px;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 20px 16px;
            }
            
            .test-container {
                padding: 24px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ“Š ì„±ì¥ ì§„ë‹¨ íŒì—… í…ŒìŠ¤íŠ¸</h1>
        <p class="subtitle">GrowthDiagnosisModal í´ë˜ìŠ¤ë¥¼ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤</p>
        
        <!-- í…ŒìŠ¤íŠ¸ ì„¹ì…˜ 1 -->
        <div class="test-section">
            <h2>ğŸ¯ ê¸°ë³¸ í…ŒìŠ¤íŠ¸</h2>
            <select id="childSelect" class="child-select">
                <option value="">ì•„ì´ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
            <button class="test-btn" onclick="openGrowthModal()">
                <span>ğŸ“Š</span>
                <span>ì„±ì¥ ì§„ë‹¨ ì—´ê¸°</span>
            </button>
            
            <div class="info-box">
                <p>
                    <strong>ğŸ“ ì‘ë™ ë°©ì‹:</strong><br>
                    1. ì•„ì´ë¥¼ ì„ íƒí•©ë‹ˆë‹¤<br>
                    2. ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ íŒì—…ì´ ì—´ë¦½ë‹ˆë‹¤<br>
                    3. ESC í‚¤ë‚˜ ë‹«ê¸° ë²„íŠ¼ìœ¼ë¡œ íŒì—…ì„ ë‹«ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤
                </p>
            </div>
        </div>
        
        <!-- í†µê³„ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="childCount">0</div>
                <div class="stat-label">ë“±ë¡ëœ ì•„ì´</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="dataCount">0</div>
                <div class="stat-label">ì„±ì¥ ë°ì´í„°</div>
            </div>
        </div>
        
        <!-- ì‚¬ìš© ì˜ˆì‹œ ì½”ë“œ -->
        <div class="test-section">
            <h2>ğŸ’» ì‚¬ìš© ì˜ˆì‹œ ì½”ë“œ</h2>
            <div class="code-block">
// íŒì—… ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
const modal = new GrowthDiagnosisModal({
    onClose: () => {
        console.log('íŒì—… ë‹«í˜');
    }
});

// íŒì—… ì—´ê¸°
modal.open('child-id-123');

// íŒì—… ë‹«ê¸°
modal.close();
            </div>
        </div>
        
        <!-- í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± -->
        <div class="test-section">
            <h2>ğŸ”§ í…ŒìŠ¤íŠ¸ ë°ì´í„°</h2>
            <button class="test-btn" onclick="generateTestData()" style="background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);">
                <span>ğŸ²</span>
                <span>í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±</span>
            </button>
            
            <div class="info-box">
                <p>
                    <strong>âš ï¸ ì£¼ì˜:</strong><br>
                    ì´ ë²„íŠ¼ì€ í…ŒìŠ¤íŠ¸ìš© ì•„ì´ ë°ì´í„°ì™€ ì„±ì¥ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.<br>
                    ì‹¤ì œ ì‚¬ìš©ì ë°ì´í„°ê°€ ìˆë‹¤ë©´ í´ë¦­í•˜ì§€ ë§ˆì„¸ìš”.
                </p>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/korea-growth-standard.js"></script>
    <script src="js/growth-diagnosis-modal.js"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let growthModal = null;
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadChildrenList();
            updateStats();
        });
        
        // ì•„ì´ ëª©ë¡ ë¡œë“œ
        function loadChildrenList() {
            const select = document.getElementById('childSelect');
            const childrenJson = localStorage.getItem('children');
            
            if (childrenJson) {
                try {
                    const children = JSON.parse(childrenJson);
                    children.forEach(child => {
                        const option = document.createElement('option');
                        option.value = child.id;
                        option.textContent = `${child.name} (${child.gender === 'male' ? 'ë‚¨' : 'ì—¬'})`;
                        select.appendChild(option);
                    });
                } catch (e) {
                    console.error('ì•„ì´ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', e);
                }
            }
        }
        
        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            // ì•„ì´ ìˆ˜
            const childrenJson = localStorage.getItem('children');
            let childCount = 0;
            if (childrenJson) {
                try {
                    const children = JSON.parse(childrenJson);
                    childCount = children.length;
                } catch (e) {}
            }
            document.getElementById('childCount').textContent = childCount;
            
            // ë°ì´í„° ìˆ˜ (localStorageì˜ routine_ í‚¤ ê°œìˆ˜)
            let dataCount = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.startsWith('routine_')) {
                    dataCount++;
                }
            }
            document.getElementById('dataCount').textContent = dataCount;
        }
        
        // íŒì—… ì—´ê¸°
        function openGrowthModal() {
            const select = document.getElementById('childSelect');
            const childId = select.value;
            
            if (!childId) {
                alert('ì•„ì´ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // íŒì—… ì¸ìŠ¤í„´ìŠ¤ ìƒì„± (í•œ ë²ˆë§Œ)
            if (!growthModal) {
                growthModal = new GrowthDiagnosisModal({
                    onClose: () => {
                        console.log('âœ… íŒì—…ì´ ë‹«í˜”ìŠµë‹ˆë‹¤');
                    }
                });
            }
            
            // íŒì—… ì—´ê¸°
            growthModal.open(childId);
        }
        
        // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
        function generateTestData() {
            if (!confirm('í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê¸°ì¡´ ë°ì´í„°ëŠ” ìœ ì§€ë˜ë©° ì¶”ê°€ë¡œ ìƒì„±ë©ë‹ˆë‹¤.')) {
                return;
            }
            
            // í…ŒìŠ¤íŠ¸ ì•„ì´ ë°ì´í„°
            const testChildren = [
                {
                    id: 'test-child-boy-1',
                    name: 'ê¹€ë¯¼ì¤€',
                    gender: 'male',
                    birth_date: '2015-03-15'
                },
                {
                    id: 'test-child-girl-1',
                    name: 'ì´ì„œìœ¤',
                    gender: 'female',
                    birth_date: '2016-07-22'
                }
            ];
            
            // ê¸°ì¡´ children ë°ì´í„° ë¡œë“œ
            let children = [];
            const childrenJson = localStorage.getItem('children');
            if (childrenJson) {
                try {
                    children = JSON.parse(childrenJson);
                } catch (e) {}
            }
            
            // í…ŒìŠ¤íŠ¸ ì•„ì´ ì¶”ê°€
            testChildren.forEach(testChild => {
                const exists = children.find(c => c.id === testChild.id);
                if (!exists) {
                    children.push(testChild);
                }
            });
            
            localStorage.setItem('children', JSON.stringify(children));
            
            // í…ŒìŠ¤íŠ¸ ì„±ì¥ ë°ì´í„° ìƒì„± (ìµœê·¼ 30ì¼)
            const today = new Date();
            testChildren.forEach(child => {
                for (let i = 0; i < 30; i++) {
                    const date = new Date(today);
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    const birthDate = new Date(child.birth_date);
                    const age = (date - birthDate) / (365.25 * 24 * 60 * 60 * 1000);
                    
                    // ì‹ ì¥ê³¼ ì²´ì¤‘ì„ ë‚˜ì´ì— ë”°ë¼ ê³„ì‚°
                    const height = child.gender === 'male' 
                        ? 75 + (age * 6.5) + (Math.random() * 2)
                        : 74 + (age * 6.0) + (Math.random() * 2);
                    
                    const weight = child.gender === 'male'
                        ? 9 + (age * 2.8) + (Math.random() * 1)
                        : 8.5 + (age * 2.6) + (Math.random() * 1);
                    
                    const routineData = {
                        date: dateStr,
                        actualAge: parseFloat(age.toFixed(1)),
                        height: parseFloat(height.toFixed(1)),
                        weight: parseFloat(weight.toFixed(1)),
                        predictedHeightBasic: parseFloat((height + 20 + Math.random() * 10).toFixed(1))
                    };
                    
                    localStorage.setItem(`routine_${child.id}_${dateStr}`, JSON.stringify(routineData));
                }
            });
            
            alert('âœ… í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' +
                  `- ì•„ì´: ${testChildren.length}ëª…\n` +
                  `- ì„±ì¥ ë°ì´í„°: ${testChildren.length * 30}ê°œ`);
            
            // UI ì—…ë°ì´íŠ¸
            location.reload();
        }
    </script>
</body>
</html>
