# 📅 데일리 루틴 달력 기능

## 개요
데일리 루틴 페이지에서 날짜를 클릭하면 달력 모달이 표시되어 월별 루틴 데이터를 한눈에 볼 수 있습니다.

---

## 주요 기능

### 1. **달력 모달**
- **날짜 클릭**: 상단의 현재 날짜를 클릭하면 달력 모달이 열립니다
- **월 이동**: ◀ ▶ 버튼으로 이전/다음 달로 이동
- **오늘 강조**: 오늘 날짜는 파란 테두리로 표시
- **선택된 날짜**: 선택한 날짜는 하늘색 배경으로 표시

### 2. **색상 인디케이터**
각 날짜에 루틴 데이터가 있으면 작은 색상 점으로 표시됩니다:

| 색상 | 카테고리 | 조건 |
|------|----------|------|
| 🟣 보라 | 수면 | 취침 시간 & 기상 시간 입력됨 |
| 🔵 파랑 | 수분 | 수분 섭취량 > 0 ml |
| 🟢 초록 | 식사 | 식사 기록 1개 이상 |
| 🟠 주황 | 운동 | 운동 기록 1개 이상 |
| 🔴 빨강 | 영양제 | 영양제 복용 1개 이상 |

### 3. **날짜 선택**
- 달력에서 날짜를 클릭하면:
  1. 해당 날짜로 이동
  2. 그 날짜의 루틴 데이터 자동 로드
  3. 모달 자동 닫기

---

## 파일 구조

### HTML
```
routine.html
├── 날짜 배너 (line 54-65)
│   └── 현재 날짜 클릭 → openRoutineCalendar()
└── 루틴 달력 모달 (line 611-642)
    ├── 모달 헤더 (제목 + 닫기 버튼)
    ├── 월 선택 버튼
    ├── 색상 범례
    └── 달력 그리드 (JavaScript로 생성)
```

### CSS
```
css/routine-calendar-modal.css
├── 모달 레이아웃 (고정 위치, 반투명 배경)
├── 달력 그리드 (7열 그리드)
├── 날짜 칸 스타일 (호버, 오늘, 선택)
└── 색상 인디케이터 (6px 원형)
```

### JavaScript
```
js/routine-calendar-modal.js
├── openRoutineCalendar() - 모달 열기
├── closeRoutineCalendar() - 모달 닫기
├── changeCalendarMonth(delta) - 월 이동
├── loadCalendarRoutineData() - Supabase에서 데이터 로드
├── renderRoutineCalendar() - 달력 렌더링
└── selectCalendarDate(y, m, d) - 날짜 선택
```

---

## 데이터베이스 쿼리

### Supabase 쿼리
```javascript
const { data, error } = await supabase
    .from('daily_routines')
    .select('*')
    .eq('child_id', selectedChildId)
    .gte('routine_date', firstDay)
    .lte('routine_date', lastDay);
```

### 데이터 구조
```javascript
calendarRoutineData = {
    1: { routine_date: '2026-02-01', sleep_time: '22:30', ... },
    4: { routine_date: '2026-02-04', water_amount: 2000, ... },
    ...
}
```

---

## 사용 예시

### 1. **모달 열기**
```
1. 상단 날짜 클릭 (예: "2026년 2월 5일 (수)")
2. 달력 모달 표시
3. 현재 월의 루틴 데이터 로드
4. 데이터가 있는 날짜에 색상 점 표시
```

### 2. **월 이동**
```
1. ◀ 버튼 클릭 → 이전 달로 이동
2. 해당 월의 데이터 자동 로드
3. 달력 다시 렌더링
```

### 3. **날짜 선택**
```
1. 달력에서 특정 날짜 클릭 (예: 1일)
2. currentDate = 2026-02-01로 설정
3. 해당 날짜 루틴 데이터 로드
4. 모달 자동 닫기
5. 입력 화면에 데이터 표시
```

---

## 테스트 방법

### 환경 설정
```bash
# 로컬 서버 실행
python -m http.server 8000
```

### 테스트 시나리오

#### 1. **병원 환자 (46번)**
```
1. http://localhost:8000/
2. 부모 ID: 46, 비밀번호: 1234
3. 데일리 루틴 페이지로 이동
4. 상단 날짜 클릭
5. 달력 확인:
   - 1월 22일 ~ 2월 4일: 다양한 색상 점 표시
   - 수면 🟣, 수분 🔵, 식사 🟢, 운동 🟠, 영양제 🔴
```

#### 2. **일반 사용자 (47번)**
```
1. http://localhost:8000/
2. 부모 ID: 47, 비밀번호: 1234
3. 데일리 루틴 페이지로 이동
4. 상단 날짜 클릭
5. 달력 확인:
   - 1월 26일 ~ 2월 4일: 색상 점 표시
   - 영양제 🔴 없음 (일반 사용자)
```

#### 3. **월 이동 테스트**
```
1. 달력 모달 열기
2. ◀ 버튼 클릭 → 1월로 이동
3. 1월 22일 ~ 31일 데이터 확인
4. ▶ 버튼 클릭 → 2월로 돌아옴
```

#### 4. **날짜 선택 테스트**
```
1. 달력 모달 열기
2. 2월 1일 클릭
3. 모달 닫힘 확인
4. 입력 화면에 2월 1일 데이터 표시 확인
```

---

## 콘솔 로그

### 정상 동작 로그
```
📅 루틴 달력 모달 열기
📊 루틴 데이터 로드: 2026-2
✅ 루틴 데이터 14개 로드 완료
📅 날짜 선택: 2026-2-1
```

### 에러 로그
```
⚠️ 선택된 아이가 없습니다
❌ 루틴 데이터 로드 실패: [error details]
```

---

## 관련 문서

- [데일리 루틴 달력 개편](ROUTINE_CALENDAR_UPGRADE.md)
- [날짜 선택 모달 디버깅](DATE_PICKER_DEBUG.md)
- [날짜 선택 모달 데이터 표시](DATE_PICKER_DATA_INDICATOR.md)
- [46번 환자 가이드](../scripts/PATIENT_46_QUICKSTART.md)
- [47번 일반 사용자 가이드](../scripts/PATIENT_47_QUICKSTART.md)

---

## 기술 스택

- **HTML5**: 모달 구조
- **CSS3**: 그리드 레이아웃, 색상 인디케이터
- **JavaScript ES6+**: 비동기 데이터 로드, 동적 렌더링
- **Supabase**: 데일리 루틴 데이터 조회
- **Chart.js**: (성장 차트용)

---

## 업데이트 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|-----------|
| 2026-02-04 | 1.0.0 | 루틴 달력 모달 초기 구현 |
| 2026-02-04 | 1.1.0 | 색상 인디케이터 추가 |
| 2026-02-05 | 1.2.0 | routine.html에 스크립트 로드 추가 |

---

## 라이선스
187 성장케어 플랫폼 © 2026
