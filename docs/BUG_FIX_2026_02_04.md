# ğŸ› ë²„ê·¸ ìˆ˜ì • ë³´ê³ ì„œ (2026-02-04)

## ğŸ“‹ ìˆ˜ì • ê°œìš”

routine.html ë° ê´€ë ¨ JavaScript íŒŒì¼ì—ì„œ ë°œìƒí•œ ì£¼ìš” ì—ëŸ¬ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ”´ ìˆ˜ì •ëœ ì—ëŸ¬

### 1. **routine.js - Supabase ì¤‘ë³µ ì„ ì–¸ ì—ëŸ¬**

#### ì—ëŸ¬ ë©”ì‹œì§€:
```
Uncaught SyntaxError: Identifier 'supabase' has already been declared
```

#### ì›ì¸:
- routine.jsì—ì„œ `const supabase`ë¥¼ ì„ ì–¸í–ˆì§€ë§Œ, ë‹¤ë¥¸ ê³³ì—ì„œ ì´ë¯¸ ì„ ì–¸ëœ ê²½ìš° ì—ëŸ¬ ë°œìƒ
- ì „ì—­ ìŠ¤ì½”í”„ì—ì„œ ì¤‘ë³µ ì„ ì–¸ ë¶ˆê°€

#### í•´ê²° ë°©ë²•:
```javascript
// ìˆ˜ì • ì „
const supabaseUrl = 'https://...';
const supabaseKey = '...';
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

// ìˆ˜ì • í›„
if (typeof supabase === 'undefined') {
    const SUPABASE_URL = 'https://...';
    const SUPABASE_ANON_KEY = '...';
    var supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
}
```

- âœ… ì¡°ê±´ë¶€ ì„ ì–¸ìœ¼ë¡œ ë³€ê²½
- âœ… ì´ë¯¸ ì„ ì–¸ë˜ì–´ ìˆìœ¼ë©´ ì¬ì„ ì–¸í•˜ì§€ ì•ŠìŒ

---

### 2. **switchView í•¨ìˆ˜ - ì •ì˜ë˜ì§€ ì•ŠìŒ ì—ëŸ¬**

#### ì—ëŸ¬ ë©”ì‹œì§€:
```
Uncaught ReferenceError: switchView is not defined
at HTMLButtonElement.onclick (routine.html:116)
```

#### ì›ì¸:
- `routine.js`ì— `function switchView(view) { ... }`ë¡œ ì„ ì–¸ë˜ì–´ ìˆì§€ë§Œ ì „ì—­ìœ¼ë¡œ ë…¸ì¶œë˜ì§€ ì•ŠìŒ
- HTMLì˜ `onclick="switchView('input')"`ì—ì„œ í˜¸ì¶œí•  ìˆ˜ ì—†ìŒ

#### í•´ê²° ë°©ë²•:
```javascript
// ìˆ˜ì • ì „
function switchView(view) {
    // ...
}

// ìˆ˜ì • í›„
window.switchView = function switchView(view) {
    // ...
}
```

- âœ… `window.switchView`ë¡œ ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ
- âœ… HTML onclickì—ì„œ í˜¸ì¶œ ê°€ëŠ¥

---

### 3. **Korea-growth-standard.js weight íƒ€ì… ì´ìŠˆ**

#### ì—ëŸ¬ ë©”ì‹œì§€:
```
ì˜ëª»ëœ ìœ í˜•: weight
```

#### ì›ì¸:
- `calculatePercentile()` í•¨ìˆ˜ì˜ `type` íŒŒë¼ë¯¸í„° ê²€ì¦ì´ ì—„ê²©í•¨
- ì˜ëª»ëœ ê°’ì´ ë“¤ì–´ì™”ì„ ë•Œ ë””ë²„ê¹…ì´ ì–´ë ¤ì›€

#### í•´ê²° ë°©ë²•:
```javascript
// ìˆ˜ì • ì „
const typeData = genderData[type];
if (!typeData) {
    console.error('ì˜ëª»ëœ ìœ í˜•:', type);
    return 50;
}

// ìˆ˜ì • í›„
const typeData = genderData[type];
if (!typeData) {
    console.error('ì˜ëª»ëœ ìœ í˜•:', type, '| ê°€ëŠ¥í•œ ê°’: height, weight | ì „ë‹¬ëœ gender:', gender, '| genderData keys:', Object.keys(genderData));
    return 50;
}
```

- âœ… ë””ë²„ê¹… ë¡œê·¸ ê°•í™”
- âœ… íƒ€ì…, gender, genderData keys ëª¨ë‘ ì¶œë ¥
- âœ… ì—ëŸ¬ ì¶”ì  ê°œì„ 

---

### 4. **CSP inline script ì´ìŠˆ**

#### ì—ëŸ¬ ë©”ì‹œì§€:
```
Refused to execute inline script because it violates the following Content Security Policy directive: "script-src 'self'"
```

#### ì›ì¸:
- `routine.html`ì— inline scriptê°€ ìˆì–´ CSP(Content Security Policy) ìœ„ë°˜
- ì¼ë¶€ í™˜ê²½ì—ì„œ inline script ì‹¤í–‰ì´ ì°¨ë‹¨ë¨

#### í•´ê²° ë°©ë²•:

**ìƒˆë¡œìš´ íŒŒì¼ ìƒì„±: `js/routine-session-check.js`**
```javascript
// ì„¸ì…˜ ì²´í¬ ë° ë°ì´í„° ì´ˆê¸°í™” ë¡œì§
const SESSION_KEY = 'growth_care_user';
const CHILDREN_KEY = 'growth_care_children';

const userJson = sessionStorage.getItem(SESSION_KEY);
if (!userJson) {
    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
    window.location.href = 'index.html';
} else {
    // ... ì¸¡ì • ë°ì´í„° ë³€í™˜ ë¡œì§
}
```

**routine.html ìˆ˜ì •:**
```html
<!-- ìˆ˜ì • ì „ -->
<script>
    const SESSION_KEY = 'growth_care_user';
    // ... ì¸ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸
</script>

<!-- ìˆ˜ì • í›„ -->
<script src="js/routine-session-check.js"></script>
```

- âœ… inline scriptë¥¼ ì™¸ë¶€ íŒŒì¼ë¡œ ë¶„ë¦¬
- âœ… CSP ì •ì±… ì¤€ìˆ˜
- âœ… ë³´ì•ˆ ê°•í™”

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼

### ìˆ˜ì •ëœ íŒŒì¼:
1. `js/routine.js`
   - Supabase ì¡°ê±´ë¶€ ì„ ì–¸ (ì´ë¯¸ ì ìš©ë˜ì–´ ìˆì—ˆìŒ)
   - `switchView` ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œ

2. `js/korea-growth-standard.js`
   - ë””ë²„ê¹… ë¡œê·¸ ê°•í™”

3. `routine.html`
   - inline script ì œê±°
   - `js/routine-session-check.js` ë¡œë“œ

### ìƒˆë¡œìš´ íŒŒì¼:
1. `js/routine-session-check.js`
   - ì„¸ì…˜ ì²´í¬ ë° ë°ì´í„° ì´ˆê¸°í™” ë¡œì§

---

## âœ… í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1. **ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸**

```bash
# ë¡œì»¬ ì„œë²„ ì‹¤í–‰
python -m http.server 8000
```

```
http://localhost:8000/
```

### 2. **ë¡œê·¸ì¸**
- ë¶€ëª¨ ID: 46 (ë˜ëŠ” 1~45)
- ë¹„ë°€ë²ˆí˜¸: 1234

### 3. **ë°ì¼ë¦¬ ë£¨í‹´ í˜ì´ì§€ ì´ë™**
- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ â†’ "ë£¨í‹´" í´ë¦­
- `routine.html` ë¡œë“œ

### 4. **ì½˜ì†” ë¡œê·¸ í™•ì¸**

**ì˜ˆìƒë˜ëŠ” ì •ìƒ ë¡œê·¸:**
```
ğŸ“Š [routine.html] measurements ë°ì´í„° ë³€í™˜ ì‹œì‘
  ì²˜ë¦¬ ì¤‘: ê¹€ì„±ì¥ - 7ê°œ ì¸¡ì • ê¸°ë¡
    ì›ë³¸ measurement: {...}
    ë³€í™˜ëœ routineData: {...}
âœ… [routine.html] 7ê°œ ì¸¡ì • ê¸°ë¡ ë³€í™˜ ì™„ë£Œ
âœ… Supabase í´ë¼ì´ì–¸íŠ¸ ìƒì„±ë¨
```

**ì—ëŸ¬ê°€ ì—†ì–´ì•¼ í•¨:**
- âŒ `Uncaught SyntaxError: Identifier 'supabase' has already been declared`
- âŒ `Uncaught ReferenceError: switchView is not defined`
- âŒ `Refused to execute inline script`

### 5. **ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸**

#### ë²„íŠ¼ í´ë¦­ í…ŒìŠ¤íŠ¸:
- "ì…ë ¥" ë²„íŠ¼ í´ë¦­ â†’ inputView í‘œì‹œ
- "í†µê³„" ë²„íŠ¼ í´ë¦­ â†’ statsView í‘œì‹œ
- ì½˜ì†”ì— ì—ëŸ¬ê°€ ì—†ì–´ì•¼ í•¨

#### ë°ì´í„° ë¡œë“œ í…ŒìŠ¤íŠ¸:
- ì•„ì´ ì„ íƒ â†’ ìë…€ ì„ íƒ
- ì¸¡ì • ê¸°ë¡ í‘œì‹œ í™•ì¸
- ì„±ì¥ ê·¸ë˜í”„ í‘œì‹œ í™•ì¸

---

## ğŸ¯ ê²°ê³¼

### âœ… ìˆ˜ì • ì™„ë£Œ:
1. Supabase ì¤‘ë³µ ì„ ì–¸ ì—ëŸ¬ â†’ ì¡°ê±´ë¶€ ì„ ì–¸ìœ¼ë¡œ í•´ê²°
2. switchView í•¨ìˆ˜ ë¯¸ì •ì˜ ì—ëŸ¬ â†’ ì „ì—­ í•¨ìˆ˜ ë…¸ì¶œë¡œ í•´ê²°
3. weight íƒ€ì… ì´ìŠˆ â†’ ë””ë²„ê¹… ë¡œê·¸ ê°•í™”ë¡œ ì¶”ì  ê°€ëŠ¥
4. CSP inline script ì´ìŠˆ â†’ ì™¸ë¶€ íŒŒì¼ ë¶„ë¦¬ë¡œ í•´ê²°

### ğŸ“Š ì˜í–¥ ë²”ìœ„:
- `routine.html` í˜ì´ì§€
- `js/routine.js` íŒŒì¼
- `js/korea-growth-standard.js` íŒŒì¼
- ìƒˆë¡œìš´ íŒŒì¼: `js/routine-session-check.js`

### ğŸš€ ë‹¤ìŒ ë‹¨ê³„:
1. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ 46ë²ˆ í™˜ì í™•ì¸
2. ë°ì¼ë¦¬ ë£¨í‹´ 14ê°œ ë°ì´í„° í™•ì¸
3. ì„±ì¥ ê³¡ì„  ê·¸ë˜í”„ í™•ì¸
4. ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

---

## ğŸ“ ì°¸ê³ 

- **46ë²ˆì§¸ ê°€ìƒ í™˜ì ê°€ì´ë“œ**: [scripts/PATIENT_46_QUICKSTART.md](../scripts/PATIENT_46_QUICKSTART.md)
- **ë°ì¼ë¦¬ ë£¨í‹´ ë‹¬ë ¥ ê°œí¸**: [ROUTINE_CALENDAR_UPGRADE.md](../ROUTINE_CALENDAR_UPGRADE.md)
- **Supabase ì„¤ì • ê°€ì´ë“œ**: [SUPABASE_SETUP.md](SUPABASE_SETUP.md)

---

**ìˆ˜ì • ì¼ì‹œ**: 2026-02-04  
**ì‘ì„±ì**: AI Assistant  
**ìƒíƒœ**: âœ… ì™„ë£Œ
