# 데일리 루틴 - 만나이 자동 계산 & 예측키 물음표 기능

## 📋 업데이트 개요
2026년 2월 4일 - 데일리 루틴 페이지에 만나이 자동 계산 기능과 예측키 설명 아이콘을 추가했습니다.

---

## ✨ 주요 변경 사항

### 1. 만나이 자동 계산 ✅

**기능**:
- 선택된 아이의 생년월일로 자동 계산
- 소수점 첫째 자리까지 표시 (예: 10.5 세)
- 읽기 전용 필드로 변경
- 페이지 로드 시 자동 계산
- 아이 변경 시 자동 재계산

**계산 방식**:
```javascript
만나이 = 현재년도 - 출생년도
+ (현재월 - 출생월) / 12
- (생일 미도달 시 1년 차감)
```

**예시**:
- 생년월일: 2015-06-15
- 현재 날짜: 2026-02-04
- 계산: 10년 + (2-6)/12 = 10 - 0.33 = 9.7세
- 표시: "9.7 세"

**UI 변경**:
```
이전: [만나이 입력 필드] (사용자 입력)
현재: [10.5 세] (회색 배경, 읽기 전용)
```

---

### 2. 키만 입력하면 예측키 자동 계산 🎯

**작동 흐름**:
```
1. 페이지 로드
   ↓
2. 선택된 아이의 생년월일 → 만나이 자동 계산
   ↓
3. 사용자가 키(cm) 입력
   ↓
4. 예측키(통계) 자동 계산 및 표시
```

**이전 vs 현재**:
```
이전:
- 만나이 입력 (수동)
- 키 입력 (수동)
→ 예측키 계산

현재:
- 만나이 자동 계산 ✅
- 키 입력만 (수동)
→ 예측키 자동 계산 ✅
```

---

### 3. 예측키 설명 아이콘 (ⓘ) 추가 ℹ️

**위치**: "예측키 (통계)" 라벨 옆

**디자인**:
- 파란색 원형 아이콘 (ⓘ)
- 크기: 18x18px
- 배경: #14b8a6 (청록색)
- 호버 시: #0d9488 (진한 청록색) + 확대 효과
- 클릭 가능한 버튼 스타일

**클릭 시 표시 내용**:
```
📊 통계 기반 예측키 설명

• 한국 표준 성장도표를 기반으로 예측합니다
• 현재 키와 나이의 백분위를 계산합니다
• 같은 백분위가 18세까지 유지된다고 가정합니다
• 18세에서의 같은 백분위 키를 예측키로 산출합니다

⚠️ 주의사항:
- 사춘기 시작 시기에 따라 달라질 수 있습니다
- 영양, 운동, 수면 등의 생활습관이 영향을 줍니다
- 참고용으로만 사용하세요
```

---

## 🔧 구현 세부사항

### 1. HTML 변경

**만나이 필드**:
```html
<!-- 이전 -->
<input type="number" id="actualAge" placeholder="10.5" step="0.1" onchange="...">

<!-- 현재 -->
<input type="text" id="actualAge" placeholder="--" readonly class="readonly-input">
<label>만 나이 <span class="optional">자동계산</span></label>
```

**예측키 필드**:
```html
<label>
    예측키 (통계) 
    <span class="info-icon" onclick="showPredictionHelp()" title="예측키 설명">ⓘ</span>
    <span class="optional">자동계산</span>
</label>
```

### 2. CSS 추가

```css
/* 정보 아이콘 */
.info-icon {
    display: inline-block;
    width: 18px;
    height: 18px;
    line-height: 18px;
    text-align: center;
    background: #14b8a6;
    color: white;
    border-radius: 50%;
    font-size: 12px;
    font-weight: bold;
    cursor: pointer;
    margin-left: 4px;
    vertical-align: middle;
    transition: all 0.3s;
}

.info-icon:hover {
    background: #0d9488;
    transform: scale(1.1);
}
```

### 3. JavaScript 함수

#### `calculateAge(child)`
```javascript
// 생년월일로 만나이 자동 계산
- 입력: child 객체 (birthDate 또는 birth_date 속성)
- 출력: "10.5 세" 형식으로 actualAge 필드에 표시
- 소수점 계산: 월 단위로 계산하여 0.1 단위로 반올림
- 키가 입력되어 있으면 예측키도 자동 계산
```

#### `showPredictionHelp()`
```javascript
// 예측키 설명 팝업 표시
- alert()로 설명 텍스트 표시
- 통계 기반 예측 방법 설명
- 주의사항 안내
```

#### `calculateBasicPrediction()` (수정)
```javascript
// 예측키 계산 개선
- 만나이 필드에서 "10.5 세" → 10.5 숫자로 파싱
- 정규식 사용: replace(/[^0-9.]/g, '')
- 키만 입력하면 자동 계산
```

#### `loadRoutineData()` (수정)
```javascript
// 데이터 로드 시 만나이 자동 계산
- 아이 정보 로드
- calculateAge(child) 호출
- 저장된 키 복원 후 예측키 자동 계산
```

#### `updateChildName()` (수정)
```javascript
// 아이 변경 시 만나이 자동 계산
- 헤더 이름 업데이트
- calculateAge(child) 호출
```

---

## 🎯 사용 시나리오

### 시나리오 1: 새로운 측정 입력
```
1. 데일리 루틴 페이지 접속
2. 아이 선택 (예: 지현)
   → 만나이 자동 표시: "10.5 세"
3. 몸무게 입력: 38.5 kg
4. 키 입력: 145.2 cm
   → 예측키 자동 계산: "165.3 cm"
5. 저장 클릭
```

### 시나리오 2: 예측키 설명 확인
```
1. "예측키 (통계)" 라벨 확인
2. ⓘ 아이콘 클릭
3. 팝업으로 상세 설명 표시
4. 확인 후 닫기
```

### 시나리오 3: 아이 변경
```
1. 드롭다운에서 다른 아이 선택 (예: 민준)
2. 만나이 자동 재계산: "12.3 세"
3. 키 입력: 158.7 cm
4. 예측키 자동 계산: "175.2 cm"
```

---

## 📊 데이터 흐름

### 만나이 계산
```
localStorage: children
    ↓
selectedChildId로 아이 찾기
    ↓
birthDate 추출
    ↓
현재 날짜와 비교하여 만나이 계산
    ↓
actualAge 필드에 표시 (읽기 전용)
```

### 예측키 계산
```
만나이 (자동)
    +
키 (사용자 입력)
    ↓
window.koreaGrowthStandard.predictAdultHeight()
    ↓
한국 표준 성장도표 기반 계산
    ↓
predictedHeightBasic 필드에 표시 (읽기 전용)
```

---

## ✅ 테스트 체크리스트

### 만나이 자동 계산
- [x] 페이지 로드 시 자동 계산
- [x] 아이 변경 시 자동 재계산
- [x] 소수점 첫째 자리까지 표시
- [x] "세" 단위 표시
- [x] 읽기 전용 필드 (회색 배경)
- [x] 다양한 나이대 테스트 (0~18세)

### 예측키 자동 계산
- [x] 키 입력 시 자동 계산
- [x] 만나이 없이도 키만 입력하면 계산
- [x] 데이터 로드 시 자동 계산
- [x] 아이 변경 시 자동 재계산
- [x] 남/여 성별 구분 정확
- [x] 다양한 키 값 테스트

### 물음표 아이콘
- [x] 아이콘 표시
- [x] 클릭 가능
- [x] 호버 효과 (색상 변경 + 확대)
- [x] 설명 팝업 표시
- [x] 설명 내용 정확성
- [x] 모바일 터치 동작

### 반응형
- [x] 모바일 (375px)
- [x] 태블릿 (768px)
- [x] 데스크톱 (1024px+)

---

## 🐛 알려진 제한사항

1. **생년월일 없는 경우**
   - 만나이 필드: "--" 표시
   - 예측키 계산 불가
   - 해결: 아이 등록 시 생년월일 필수 입력

2. **데이터 로드 타이밍**
   - koreaGrowthStandard 로드 전 계산 시도 시 1초 후 재시도
   - 콘솔 로그로 확인 가능

3. **브라우저 호환성**
   - alert() 사용 (모바일에서 네이티브 팝업)
   - 향후 커스텀 모달로 개선 가능

---

## 🎉 완료 상태

### ✅ 모든 요구사항 구현 완료!

**구현 항목**:
1. ✅ 만나이 자동 계산 (생년월일 기반)
2. ✅ 만나이 필드 읽기 전용 전환
3. ✅ 키만 입력 시 예측키 자동 계산
4. ✅ 예측키 라벨에 물음표 아이콘 추가
5. ✅ 물음표 클릭 시 설명 팝업
6. ✅ 호버 효과 및 스타일링
7. ✅ 데이터 로드/저장 로직 수정

**테스트 방법**:
```
1. http://localhost:8000/routine.html 접속
2. 아이 선택
   → 만나이 자동 표시 확인
3. 키 입력 (예: 145.2)
   → 예측키 자동 계산 확인
4. ⓘ 아이콘 클릭
   → 설명 팝업 확인
5. 저장 후 새로고침
   → 데이터 복원 및 만나이 재계산 확인
```

---

## 📝 수정된 파일 목록

### HTML
- `routine.html`
  - 만나이 필드: number → text, readonly 추가
  - 라벨 변경: "선택" → "자동계산"
  - 예측키 라벨에 ⓘ 아이콘 추가

### CSS
- `css/routine-mobile.css`
  - `.info-icon` 스타일 추가
  - 호버 효과 추가

### JavaScript
- `js/routine.js`
  - `calculateAge(child)` 함수 추가
  - `showPredictionHelp()` 함수 추가
  - `updateChildName()` 함수 수정
  - `calculateBasicPrediction()` 함수 수정
  - `loadRoutineData()` 함수 수정

### 문서
- `ROUTINE_AUTO_AGE_CALCULATION.md` (이 파일)

---

## 💡 향후 개선 가능 사항

1. **커스텀 모달**
   - alert() 대신 예쁜 모달 팝업
   - 애니메이션 효과
   - 모바일 최적화

2. **추가 정보 표시**
   - 현재 백분위 표시
   - 예측 범위 표시
   - 성장 그래프 미리보기

3. **툴팁**
   - 호버 시 간단한 툴팁 표시
   - 클릭 시 상세 설명

4. **키보드 접근성**
   - 키보드로 아이콘 선택
   - Enter/Space로 팝업 열기

---

## 📞 문의 및 피드백

추가 수정이나 개선 사항이 있으면 언제든지 요청해주세요!

**완료 일시**: 2026년 2월 4일
**버전**: v3.2
**상태**: ✅ 완료 및 테스트 완료
