<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ ì„±ì¥ë„í‘œ ë°ì´í„° ì¶”ì¶œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
        .info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š í•œêµ­ ì„±ì¥ë„í‘œ ë°ì´í„° ì¶”ì¶œê¸°</h1>
    
    <div class="info">
        <h3>ğŸ¯ ëª©ì </h3>
        <p>í•œêµ­ ì†Œì•„ì²­ì†Œë…„ í‘œì¤€ ì„±ì¥ë„í‘œ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>
        <p>LMS ë°©ë²• (Lambda-Mu-Sigma)ì„ ì‚¬ìš©í•˜ì—¬ ì •í™•í•œ ë°±ë¶„ìœ„ ê³„ì‚°ê³¼ 18ì„¸ ì˜ˆì¸¡í‚¤ë¥¼ ì‚°ì¶œí•©ë‹ˆë‹¤.</p>
    </div>

    <button onclick="loadExcel()">ì—‘ì…€ íŒŒì¼ ë¡œë“œ</button>
    <button onclick="downloadJSON()">JSON ë‹¤ìš´ë¡œë“œ</button>
    <button onclick="copyJSON()">JSON ë³µì‚¬</button>

    <div id="sheetNames"></div>
    <div id="tableContainer"></div>
    <div id="jsonContainer"></div>

    <script>
        let workbook = null;
        let extractedData = {};

        async function loadExcel() {
            try {
                const response = await fetch('data/korea_growth_chart.xls');
                const arrayBuffer = await response.arrayBuffer();
                workbook = XLSX.read(arrayBuffer, { type: 'array' });
                
                console.log('âœ… ì—‘ì…€ íŒŒì¼ ë¡œë“œ ì™„ë£Œ');
                console.log('ğŸ“‹ ì‹œíŠ¸ ëª©ë¡:', workbook.SheetNames);
                
                displaySheetNames();
                extractGrowthData();
            } catch (error) {
                console.error('âŒ ì—‘ì…€ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì—‘ì…€ íŒŒì¼ì„ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function displaySheetNames() {
            const container = document.getElementById('sheetNames');
            container.innerHTML = '<h3>ğŸ“‘ ì‹œíŠ¸ ëª©ë¡</h3>';
            
            const ul = document.createElement('ul');
            workbook.SheetNames.forEach((name, index) => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <strong>${index + 1}. ${name}</strong>
                    <button onclick="showSheet('${name}')">ë³´ê¸°</button>
                `;
                ul.appendChild(li);
            });
            container.appendChild(ul);
        }

        function showSheet(sheetName) {
            const sheet = workbook.Sheets[sheetName];
            const html = XLSX.utils.sheet_to_html(sheet);
            
            const container = document.getElementById('tableContainer');
            container.innerHTML = `<h3>ğŸ“Š ì‹œíŠ¸: ${sheetName}</h3>${html}`;
        }

        function extractGrowthData() {
            console.log('ğŸ” ì„±ì¥ë„í‘œ ë°ì´í„° ì¶”ì¶œ ì‹œì‘...');
            
            extractedData = {
                version: '2017 ì†Œì•„ì²­ì†Œë…„ ì„±ì¥ë„í‘œ',
                source: 'ì§ˆë³‘ê´€ë¦¬ì²­',
                male: {
                    height: extractHeightData('male'),
                    weight: extractWeightData('male')
                },
                female: {
                    height: extractHeightData('female'),
                    weight: extractWeightData('female')
                }
            };
            
            displayJSON();
            console.log('âœ… ë°ì´í„° ì¶”ì¶œ ì™„ë£Œ:', extractedData);
        }

        function extractHeightData(gender) {
            // ì‹œíŠ¸ ì´ë¦„ ì°¾ê¸° (ë‚¨ì•„ í‚¤, ì—¬ì•„ í‚¤ ë“±)
            const sheetNames = workbook.SheetNames;
            let targetSheet = null;
            
            if (gender === 'male') {
                targetSheet = sheetNames.find(name => 
                    name.includes('ë‚¨ì•„') && name.includes('í‚¤') || 
                    name.includes('ë‚¨') && name.includes('ì‹ ì¥')
                );
            } else {
                targetSheet = sheetNames.find(name => 
                    name.includes('ì—¬ì•„') && name.includes('í‚¤') || 
                    name.includes('ì—¬') && name.includes('ì‹ ì¥')
                );
            }
            
            if (!targetSheet) {
                console.warn(`âš ï¸ ${gender} í‚¤ ë°ì´í„° ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                return [];
            }
            
            console.log(`ğŸ“Š ${gender} í‚¤ ë°ì´í„° ì‹œíŠ¸: ${targetSheet}`);
            
            const sheet = workbook.Sheets[targetSheet];
            const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            
            return parseGrowthSheet(jsonData, 'height');
        }

        function extractWeightData(gender) {
            const sheetNames = workbook.SheetNames;
            let targetSheet = null;
            
            if (gender === 'male') {
                targetSheet = sheetNames.find(name => 
                    name.includes('ë‚¨ì•„') && name.includes('ì²´ì¤‘') || 
                    name.includes('ë‚¨') && name.includes('ëª¸ë¬´ê²Œ')
                );
            } else {
                targetSheet = sheetNames.find(name => 
                    name.includes('ì—¬ì•„') && name.includes('ì²´ì¤‘') || 
                    name.includes('ì—¬') && name.includes('ëª¸ë¬´ê²Œ')
                );
            }
            
            if (!targetSheet) {
                console.warn(`âš ï¸ ${gender} ì²´ì¤‘ ë°ì´í„° ì‹œíŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                return [];
            }
            
            console.log(`ğŸ“Š ${gender} ì²´ì¤‘ ë°ì´í„° ì‹œíŠ¸: ${targetSheet}`);
            
            const sheet = workbook.Sheets[targetSheet];
            const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
            
            return parseGrowthSheet(jsonData, 'weight');
        }

        function parseGrowthSheet(data, type) {
            // ë°ì´í„° íŒŒì‹± ë¡œì§
            // LMS ë°ì´í„° í˜•ì‹: ì›”ë ¹/ì—°ë ¹, L, M, S, P3, P5, P10, P25, P50, P75, P90, P95, P97
            
            const result = [];
            
            // í—¤ë” ì°¾ê¸°
            let headerRow = -1;
            for (let i = 0; i < Math.min(10, data.length); i++) {
                const row = data[i];
                if (row && (
                    row.some(cell => String(cell).includes('ì›”ë ¹') || String(cell).includes('ì—°ë ¹')) ||
                    row.some(cell => String(cell).includes('Age') || String(cell).includes('Month'))
                )) {
                    headerRow = i;
                    break;
                }
            }
            
            if (headerRow === -1) {
                console.warn('âš ï¸ í—¤ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return result;
            }
            
            console.log(`ğŸ“‹ í—¤ë” í–‰: ${headerRow}`, data[headerRow]);
            
            // ë°ì´í„° ì¶”ì¶œ
            for (let i = headerRow + 1; i < data.length; i++) {
                const row = data[i];
                if (!row || row.length === 0) continue;
                
                const age = parseFloat(row[0]);
                if (isNaN(age)) continue;
                
                // LMS ê°’ ì¶”ì¶œ
                const dataPoint = {
                    age: age,
                    L: parseFloat(row[1]) || 1,
                    M: parseFloat(row[2]) || 0,
                    S: parseFloat(row[3]) || 0.1,
                    P3: parseFloat(row[4]) || 0,
                    P5: parseFloat(row[5]) || 0,
                    P10: parseFloat(row[6]) || 0,
                    P25: parseFloat(row[7]) || 0,
                    P50: parseFloat(row[8]) || 0,
                    P75: parseFloat(row[9]) || 0,
                    P90: parseFloat(row[10]) || 0,
                    P95: parseFloat(row[11]) || 0,
                    P97: parseFloat(row[12]) || 0
                };
                
                result.push(dataPoint);
            }
            
            console.log(`âœ… ${type} ë°ì´í„° ${result.length}ê°œ ì¶”ì¶œ`);
            return result;
        }

        function displayJSON() {
            const container = document.getElementById('jsonContainer');
            const jsonStr = JSON.stringify(extractedData, null, 2);
            
            container.innerHTML = `
                <h3>ğŸ“„ ì¶”ì¶œëœ JSON ë°ì´í„°</h3>
                <p>ë‚¨ì•„ í‚¤: ${extractedData.male.height.length}ê°œ ë°ì´í„°</p>
                <p>ë‚¨ì•„ ì²´ì¤‘: ${extractedData.male.weight.length}ê°œ ë°ì´í„°</p>
                <p>ì—¬ì•„ í‚¤: ${extractedData.female.height.length}ê°œ ë°ì´í„°</p>
                <p>ì—¬ì•„ ì²´ì¤‘: ${extractedData.female.weight.length}ê°œ ë°ì´í„°</p>
                <pre id="jsonOutput">${jsonStr}</pre>
            `;
        }

        function downloadJSON() {
            if (!extractedData.male || !extractedData.female) {
                alert('ë¨¼ì € "ì—‘ì…€ íŒŒì¼ ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
                return;
            }
            
            const jsonStr = JSON.stringify(extractedData, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'korea_growth_data.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… JSON íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function copyJSON() {
            const jsonOutput = document.getElementById('jsonOutput');
            if (!jsonOutput) {
                alert('ë¨¼ì € "ì—‘ì…€ íŒŒì¼ ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
                return;
            }
            
            navigator.clipboard.writeText(jsonOutput.textContent).then(() => {
                alert('âœ… JSONì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(err => {
                alert('âŒ ë³µì‚¬ ì‹¤íŒ¨: ' + err.message);
            });
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            console.log('ğŸ“Š í•œêµ­ ì„±ì¥ë„í‘œ ë°ì´í„° ì¶”ì¶œê¸° ì‹œì‘');
        });
    </script>
</body>
</html>
