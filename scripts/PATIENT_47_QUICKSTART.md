# 🧪 47번 일반 사용자 생성 가이드

## 📋 개요

47번 **일반 사용자** (병원 환자 아님) 가상 데이터 생성 가이드입니다.

---

## 👤 사용자 정보

### 부모 (일반 사용자)
- **이메일**: `0047@example.com`
- **비밀번호**: `1234`
- **이름**: 테스트 일반사용자47
- **전화**: 010-9999-0047
- **역할**: parent
- **병원 환자 여부**: ❌ **false** (일반 사용자)

### 자녀
- **이름**: 박성장
- **성별**: 여아 (female)
- **생년월일**: 2012-08-20
- **현재 나이**: 만 13.45세

---

## 📊 데이터 구성

### 측정 기록: 7개

| 날짜 | 키(cm) | 몸무게(kg) | 나이 | 뼈나이 | PAH | 성장(cm) | 메모 |
|------|---------|-----------|------|---------|------|----------|------|
| 2023-08-20 | 145.2 | 38.5 | 11.0 | 10.5 | 160.0 | - | 초진 - 성장 관심으로 앱 시작 |
| 2024-02-20 | 149.8 | 41.2 | 11.5 | 11.0 | 162.5 | +4.6 | 6개월 성장 |
| 2024-08-20 | 154.3 | 44.8 | 12.0 | 11.5 | 164.2 | +4.5 | 1년 성장 - 9.1cm |
| 2025-02-20 | 158.1 | 47.5 | 12.5 | 12.0 | 165.3 | +3.8 | 6개월 성장 |
| 2025-08-20 | 161.5 | 50.2 | 13.0 | 12.5 | 166.1 | +3.4 | 1년 성장 - 7.2cm |
| 2025-11-20 | 163.2 | 51.8 | 13.25 | 12.8 | 166.5 | +1.7 | 3개월 성장 |
| 2026-02-04 | 164.8 | 53.2 | 13.45 | 13.0 | 166.9 | +1.6 | 최근 측정 |

**총 성장**: 19.6cm (145.2 → 164.8)

---

### 데일리 루틴: 10개

| 날짜 | 키 | 수면 | 수분 | 식사 | 운동 | 영양제 | 성장주사 | 기분 |
|------|-----|------|------|------|------|--------|----------|------|
| 2026-01-26 | 164.8 | 8.5h | 1600ml | 3끼 | 배드민턴 40분, 스트레칭 10분 | 칼슘, 비타민D | ❌ | 😊 좋음 |
| 2026-01-27 | 164.8 | 8.1h | 1500ml | 3끼 | 줄넘기 20분, 걷기 30분 | 칼슘, 비타민D | ❌ | 😐 보통 |
| 2026-01-28 | 164.8 | 9.0h | 1800ml | 4끼 | 배드민턴 50분, 스트레칭 15분 | 칼슘, 비타민D, 오메가3 | ❌ | 😄 매우좋음 |
| 2026-01-29 | 164.8 | 8.5h | 1700ml | 3끼 | 줄넘기 25분, 요가 20분 | 칼슘, 비타민D | ❌ | 😊 좋음 |
| 2026-01-30 | 164.9 | 8.5h | 1400ml | 3끼 | 걷기 30분 | 칼슘 | ❌ | 😄 매우좋음 |
| 2026-01-31 | 164.9 | 8.5h | 1500ml | 2끼 | 배드민턴 60분, 자전거 40분 | 칼슘, 비타민D | ❌ | 😄 매우좋음 |
| 2026-02-01 | 164.9 | 9.0h | 1600ml | 3끼 | 걷기 40분, 스트레칭 15분 | 칼슘, 비타민D | ❌ | 😊 좋음 |
| 2026-02-02 | 164.9 | 8.5h | 1700ml | 3끼 | 배드민턴 45분, 스트레칭 10분 | 칼슘, 비타민D, 오메가3 | ❌ | 😊 좋음 |
| 2026-02-03 | 165.0 | 9.0h | 1900ml | 3끼 | 배드민턴 55분, 요가 20분 | 칼슘, 비타민D, 오메가3 | ❌ | 😄 매우좋음 |
| 2026-02-04 | 165.0 | 8.5h | 1800ml | 3끼 | 배드민턴 40분, 스트레칭 15분 | 칼슘, 비타민D | ❌ | 😊 좋음 |

**특징:**
- ✅ 규칙적인 수면 (평균 8.6시간)
- ✅ 충분한 수분 섭취 (평균 1,650ml)
- ✅ 꾸준한 운동 (주로 배드민턴)
- ✅ 영양제 복용
- ❌ **성장주사 없음** (일반 사용자)

---

## 🚀 실행 방법

### 1. Supabase SQL Editor 접속

```
1. https://supabase.com 접속
2. 프로젝트 선택
3. SQL Editor 클릭
```

### 2. SQL 스크립트 실행

```
1. scripts/create_patient_47.sql 파일 열기
2. 전체 내용 복사
3. SQL Editor에 붙여넣기
4. Run 버튼 클릭 (또는 Ctrl+Enter)
```

### 3. 성공 메시지 확인

```sql
✅ 47번 일반 사용자 및 데일리 루틴 데이터 생성 완료!
```

### 4. 확인 쿼리

```sql
-- 부모 확인
SELECT * FROM users WHERE email = '0047@example.com';

-- 자녀 확인
SELECT * FROM children WHERE name = '박성장';

-- 측정 기록 확인 (7개)
SELECT measured_date, height, weight, notes
FROM measurements
WHERE child_id = (SELECT id FROM children WHERE name = '박성장')
ORDER BY measured_date;

-- 데일리 루틴 확인 (10개)
SELECT routine_date, height, weight, growth_injection
FROM daily_routines
WHERE child_id = (SELECT id FROM children WHERE name = '박성장')
ORDER BY routine_date DESC;

-- is_patient 확인
SELECT name, email, is_patient
FROM users
WHERE email = '0047@example.com';
```

---

## 🧪 테스트 방법

### 1. 관리자 페이지 테스트

```bash
python -m http.server 8000
```

```
http://localhost:8000/admin-dashboard.html
비밀번호: 1234
```

#### 체크리스트:
- [ ] 검색: "테스트 일반사용자47" 입력
- [ ] 배지 확인: **👤 일반사용자** (회색 배지)
- [ ] 필터 테스트:
  - "전체" → 47번 표시됨
  - "🏥 병원환자" → 47번 표시 안 됨
  - "👤 일반사용자" → 47번 표시됨
- [ ] 상세보기 클릭
- [ ] 자녀 "박성장" 확인
- [ ] 측정 기록 7개 확인
- [ ] 데일리 루틴 달력에서 10개 확인

---

### 2. 로그인 테스트 (일반 사용자)

```
http://localhost:8000/
부모 ID: 47
비밀번호: 1234
```

#### 체크리스트:
- [ ] 로그인 성공
- [ ] home.html로 이동
- [ ] 자녀 "박성장" 표시

---

### 3. 데일리 루틴 페이지 테스트

```
로그인 후 → 하단 네비게이션 → "루틴" 클릭
```

#### 체크리스트:
- [ ] 측정 탭:
  - ✅ "기본 측정" 탭 표시
  - ❌ **"자세히 측정" 탭 숨겨짐** (일반 사용자)
- [ ] 섹션:
  - ✅ 수면, 수분, 식사, 운동, 영양제 표시
  - ❌ **"성장 주사" 섹션 숨겨짐** (일반 사용자)
- [ ] 기능:
  - ✅ 데이터 로드 정상
  - ✅ 달력 표시 정상

---

### 4. 콘솔 로그 확인 (F12)

```javascript
✅ [routine.js] 사용자 정보 로드: {id: "...", name: "테스트 일반사용자47"}
✅ [routine.js] 병원 환자 여부: false
✅ [routine.js] UI 업데이트 완료 (병원환자: false)
```

---

## 📊 비교 (46번 vs 47번)

| 항목 | 46번 (병원 환자) | 47번 (일반 사용자) |
|------|-----------------|-------------------|
| **이메일** | 0046@example.com | 0047@example.com |
| **is_patient** | ✅ true | ❌ false |
| **배지** | 🏥 병원환자 | 👤 일반사용자 |
| **자녀 이름** | 김성장 (남아) | 박성장 (여아) |
| **측정 기록** | 7개 | 7개 |
| **데일리 루틴** | 14개 | 10개 |
| **자세히 측정 탭** | ✅ 표시 | ❌ 숨김 |
| **성장 주사 섹션** | ✅ 표시 | ❌ 숨김 |
| **성장 주사 투여** | 71.4% (10/14일) | 0% (일반 사용자) |

---

## 🎯 예상 결과

### 관리자 페이지:

```
┌─────────────────────────────────────────┐
│ 👪 테스트 일반사용자47  👤 일반사용자  │
│ 📧 0047@example.com                     │
│ 📞 010-9999-0047                        │
│ 👧 박성장 (13세)                        │
│                       [👁️ 상세보기]    │
└─────────────────────────────────────────┘
```

### 필터 테스트:

```
[전체] → 46개 환자 표시 (1~47번)
[🏥 병원환자] → 11개 표시 (1~10번, 46번)
[👤 일반사용자] → 36개 표시 (11~45번, 47번)
```

### 데일리 루틴 페이지:

**측정 섹션:**
```
┌─────────────────────────┐
│ [기본 측정]             │ ← 표시
└─────────────────────────┘
```

**성장 주사 섹션:**
```
(숨겨짐)
```

---

## 🐛 트러블슈팅

### 1. SQL 실행 실패

**에러**: `duplicate key value violates unique constraint`

**원인**: 이미 47번 환자가 존재함

**해결**:
```sql
-- 기존 데이터 삭제
DELETE FROM daily_routines 
WHERE child_id IN (SELECT id FROM children WHERE parent_id IN (SELECT id FROM users WHERE email = '0047@example.com'));

DELETE FROM measurements 
WHERE child_id IN (SELECT id FROM children WHERE parent_id IN (SELECT id FROM users WHERE email = '0047@example.com'));

DELETE FROM children 
WHERE parent_id IN (SELECT id FROM users WHERE email = '0047@example.com');

DELETE FROM users WHERE email = '0047@example.com';

-- 다시 실행
```

---

### 2. 로그인 안 됨

**확인 사항:**
- [ ] Supabase SQL 실행 완료
- [ ] 이메일: `0047@example.com`
- [ ] 비밀번호: `1234`
- [ ] 부모 ID: `47`

---

### 3. 자세히 측정/성장주사가 표시됨

**확인 사항:**
- [ ] `is_patient` 값 확인:
```sql
SELECT name, email, is_patient 
FROM users 
WHERE email = '0047@example.com';
```

**예상 결과**: `is_patient = false`

**만약 true이면**:
```sql
UPDATE users
SET is_patient = false
WHERE email = '0047@example.com';
```

---

## 📝 참고 문서

- **[병원 환자 구분 기능 가이드](../docs/PATIENT_TYPE_FEATURE.md)**
- **[46번 환자 가이드](PATIENT_46_QUICKSTART.md)**
- **[README](../README.md)**

---

**작성 일시**: 2026-02-04  
**작성자**: AI Assistant  
**상태**: ✅ 준비 완료
